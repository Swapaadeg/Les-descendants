RewriteEngine On
RewriteBase /api/

# =========================
# PROTECTIONS PRIORITAIRES
# =========================

# Protection du dossier scripts (DOIT ÊTRE EN PREMIER)
RewriteRule ^scripts/ - [F,L]

# =========================
# ROUTAGE API (CRUCIAL)
# =========================

# Laisser passer les fichiers existants (PHP, uploads, etc.)
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

# Laisser passer les dossiers existants
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# =========================
# PROTECTIONS
# =========================

# Protection des fichiers sensibles
<FilesMatch "(config\.php|config\.local\.php|composer\.(json|lock))$">
    Require all denied
</FilesMatch>

# Protection des fichiers SQL
<FilesMatch "\.(sql|db|sqlite)$">
    Require all denied
</FilesMatch>

# =========================
# SÉCURITÉ
# =========================

# CORS géré dans config.php (PHP) - NE PAS DUPLIQUER ICI

<IfModule mod_headers.c>
    # Headers de sécurité uniquement
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "DENY"
    Header set X-XSS-Protection "1; mode=block"
    Header set Referrer-Policy "strict-origin-when-cross-origin"

    # CSP removed - not needed for JSON API and can interfere with responses

    Header set Cache-Control "no-store, no-cache, must-revalidate, max-age=0"
    Header set Pragma "no-cache"
</IfModule>
